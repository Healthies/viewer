!function(e,t){var a="OMHWebVisualizations";e[a]=t(e,a),e[a].QUANTIZE_YEAR=6,e[a].QUANTIZE_MONTH=5,e[a].QUANTIZE_DAY=4,e[a].QUANTIZE_HOUR=3,e[a].QUANTIZE_MINUTE=2,e[a].QUANTIZE_SECOND=1,e[a].QUANTIZE_MILLISECOND=0,e[a].QUANTIZE_NONE=-1,e[a].Utils={},e[a].Utils.mergeObjects=function(t,n){function i(i){if(void 0===o[i]){var r=t[i],s=n[i];typeof r==typeof s&&"object"==typeof r?o[i]=e[a].Utils.mergeObjects(r||{},s||{}):(o[i]=r,n.hasOwnProperty(i)&&(o[i]=s))}}var o={};for(var r in t)i(r);for(r in n)i(r);return o}}(this,function(e,t){var a=e.hasOwnProperty(t)?e[t]:{};return a.Chart=function(e,t,n,i){var o=864e5,r=.5,s="1px",l="1px";this.initialized=!1,"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]),t.node||(t=d3.select(t)),i||(i={});var u=null;t.classed("omh-chart-container",!0);var m=null,c=n.split(/\s*,\s*/),d={},h={},f=null,p=null,v={userInterface:{toolbar:{enabled:!0},timespanButtons:{enabled:!0},zoomButtons:{enabled:!0},navigation:{enabled:!0},tooltips:{enabled:!0,timeFormat:"M/D/YY, h:mma"},panZoom:{enabled:!0,showHint:!0}},measures:{body_weight:{valueKeyPath:"body.body_weight.value",range:{min:0,max:100},units:"kg",thresholds:{max:57}},heart_rate:{valueKeyPath:"body.heart_rate.value",range:{min:30,max:150},units:"bpm"},step_count:{valueKeyPath:"body.step_count",range:{min:0,max:1500},units:"Steps",seriesName:"Steps",timeQuantizationLevel:a.QUANTIZE_DAY,chart:{type:"clustered_bar",barColor:"#eeeeee",daysShownOnTimeline:{min:7,max:90}}},minutes_moderate_activity:{valueKeyPath:"body.minutes_moderate_activity.value",range:{min:0,max:300},units:"Minutes",seriesName:"Minutes of moderate activity",timeQuantizationLevel:a.QUANTIZE_DAY,chart:{type:"clustered_bar",daysShownOnTimeline:{min:7,max:90}}},systolic_blood_pressure:{valueKeyPath:"body.systolic_blood_pressure.value",range:{min:30,max:200},units:"mmHg",thresholds:{max:120}},diastolic_blood_pressure:{valueKeyPath:"body.diastolic_blood_pressure.value",range:{min:30,max:200},units:"mmHg",thresholds:{max:80}}}},b={range:{min:0,max:100},units:"Units",seriesName:"Series",timeQuantizationLevel:a.QUANTIZE_NONE,chart:{type:"line",pointSize:9,lineColor:"#dedede",pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6",aboveThesholdPointFillColor:"#e8ac4e",aboveThesholdPointStrokeColor:"#745628",barColor:"#4a90e2",daysShownOnTimeline:{min:1,max:1e3}}};this.destroy=function(){Ue&&Ue.offPointerMove(Se),Ue&&Ue.detachFrom(H),O&&O.detachFrom(f),f&&f.destroy(),Ze&&Ze.destroy(),p&&p.offWheel(U),Oe&&O.offDrag(Oe),be&&be.remove(),P&&E.offUpdate(P)},this.getComponents=function(){if(!this.initialized)return{};var e={};e[c[0]]=E;var t={};t[c[0]]=A;var a={};a[c[0]]=C;var n={};n[c[0]]=w;var i={};i[c[0]]=I;var o={};return o[c[0]]=K,B.forEach(function(n){e[n.measure]=n.scale,t[n.measure]=n.axis,a[n.measure]=n.label}),{xScales:n,yScales:e,colorScales:o,gridlines:null,legends:[G],xAxes:i,yAxes:t,plots:S,yLabels:a,table:f,tooltip:Ze,toolbar:be,panZoomInteractions:{plotGroup:se,xAxis:le}}},this.getD3Selection=function(){return u};var g=a.Utils.mergeObjects(v,i);d3.keys(g.measures).forEach(function(e){g.measures[e]=a.Utils.mergeObjects(b,g.measures[e])});var y=g.userInterface,_=function(e){return g.measures[e]},x={},D=function(e,t){if(void 0===e)return e;var a;"string"==typeof t?(x[t]||(x[t]=t.split(".")),a=x[t].slice()):a=t;try{if(t&&a.length>0)return D(e[a.shift()],a)}catch(n){console.info("Exception while resolving keypath",n)}return e};if(this.getIntervalDisplayDate=function(e,t,a){var n=e.body.effective_time_frame.time_interval,i=n.start_date_time?new Date(n.start_date_time).getTime():null,o=n.end_date_time?new Date(n.end_date_time).getTime():null,r=n.start_date_time?t(n.start_date_time):null,s=n.end_date_time?t(n.end_date_time):null,l={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},u=n.duration?n.duration.value:null;if(u){var m,c=n.duration.unit,d=l[c];"string"!=typeof d?(m=u*d,i||(i=o-m),o||(o=i+m)):(i||(i=s.subtract(u,l[c]).valueOf()),o||(o=r.add(u,l[c]).valueOf()))}var h=new Date(i),f=a<=OMHWebVisualizations.QUANTIZE_MONTH?h.getMonth():6,p=a<=OMHWebVisualizations.QUANTIZE_DAY?h.getDate():a===OMHWebVisualizations.QUANTIZE_MONTH?15:1,v=a<=OMHWebVisualizations.QUANTIZE_HOUR?h.getHours():a===OMHWebVisualizations.QUANTIZE_DAY?12:0,b=a<=OMHWebVisualizations.QUANTIZE_MINUTE?h.getMinutes():a===OMHWebVisualizations.QUANTIZE_HOUR?30:0,g=a<=OMHWebVisualizations.QUANTIZE_SECOND?h.getSeconds():a===OMHWebVisualizations.QUANTIZE_MINUTE?30:0,y=a<=OMHWebVisualizations.QUANTIZE_MILLISECOND?h.getMilliseconds():a===OMHWebVisualizations.QUANTIZE_SECOND?500:0,_=new Date(h.getFullYear(),f,p,v,b,g,y);return _},this.parseOmhData=function(e,t,a){var n={},i=this;return e&&0!==e.length?(e.forEach(function(e){e.groupName="",t.forEach(function(t,o){var r=_(t).valueKeyPath,s=D(e,r);if(void 0!==s&&"object"!=typeof s){e.groupName+="_"+t,n.hasOwnProperty(t)||(n[t]=[]);var l;if(e.body.effective_time_frame.date_time&&(l=new Date(e.body.effective_time_frame.date_time)),e.body.effective_time_frame.time_interval){var u=_(t).timeQuantizationLevel;l=i.getIntervalDisplayDate(e,a,u)}var m=_(t).valueKeyPath,c=D(e,m);n[t].push({y:c,x:l,provider:e.header.acquisition_provenance.source_name,omhDatum:e,hasTooltip:0===o,measure:t})}})}),n):n},dataCopy=JSON.parse(JSON.stringify(e)),m=this.parseOmhData(dataCopy,c,moment),0===Object.keys(m).length)return void console.log("Warning: no data of the specified type could be found.");this.consolidateData=function(e){e.sort(function(e,t){return e.x.getTime()-t.x.getTime()});for(var t=0;t<e.length;t++)for(;t+1<e.length&&e[t+1].x.getTime()===e[t].x.getTime();)e[t].y+=e[t+1].y,e[t].accumulatedDataBodies||(e[t].accumulatedDataBodies=[e[t].omhDatum.body]),e[t].accumulatedDataBodies.push(e[t+1].omhDatum.body),e.splice(t+1,1)},m.minutes_moderate_activity&&this.consolidateData(m.minutes_moderate_activity),m.step_count&&this.consolidateData(m.step_count);var T=_(c[0]),w=new Plottable.Scales.Time,E=new Plottable.Scales.Linear,P=null,N=T.range;N&&E.domainMin(N.min).domainMax(N.max);var I=new Plottable.Axes.Time(w,"bottom").margin(15).addClass("x-axis"),A=new Plottable.Axes.Numeric(E,"left"),C=new Plottable.Components.AxisLabel(T.units,"0").padding(5).xAlignment("right").yAlignment("top"),O=new Plottable.Interactions.Drag,M=function(){$&&$(),Ze&&Oe&&Oe()};O.onDrag(M);var U=function(){Oe&&Oe(),ve&&ve(),$&&$()},S=[],z=function(e){var t=_(e.measure).thresholds;return t&&e.y>t.max},Z=function(e){var t=_(e.measure).chart;return z(e)?t.aboveThesholdPointFillColor:t.pointFillColor},k=function(e){var t=_(e.measure).chart;return z(e)?t.aboveThesholdPointStrokeColor:t.pointStrokeColor},Q=function(e){return _(e.measure).chart.barColor},H=(new Plottable.Plots.Scatter).x(function(e){return e.x},w).y(function(e){return e.y},E).size(function(e){return _(e.measure).chart.pointSize}).attr("fill",function(e){return Z(e)}).attr("opacity",r).attr("stroke-width",l).attr("stroke",function(e){return k(e)}),L=[],W=0,B=[];d3.entries(m).forEach(function(e){var t=e.key;"clustered_bar"===_(t).chart.type&&W++});var F=[];if(d3.entries(m).forEach(function(e){measure=e.key;var t=_(measure).thresholds;t&&F.push(t.max)}),F.length>0){F.sort(function(e,t){return e-t});var V=new Plottable.Scales.Linear;V.domain(E.domain()),V.range(E.range()),P=function(e){V.domain(e.domain()),V.range(e.range())},E.onUpdate(P);var R=function(e){var t=(e.domain(),F);return t};V.tickGenerator(R);var j=new Plottable.Axes.Numeric(V,"right").tickLabelPosition("top").tickLabelPadding(5).showEndTickLabels(!0),Y=new Plottable.Components.Gridlines(null,V);S.push(Y),S.push(j)}c.forEach(function(e){if(m.hasOwnProperty(e)){var t=m[e],a=new Plottable.Dataset(t),n=_(e);if(a.measure=e,"clustered_bar"===n.chart.type){var i=E;if(L.length>0){var o=n.range,r=n.units;i=(new Plottable.Scales.Linear).domainMin(o.min).domainMax(o.max);var l=new Plottable.Axes.Numeric(i,"right"),u=new Plottable.Components.AxisLabel(r,"0").padding(5).xAlignment("left").yAlignment("top");B.push({measure:e,axis:l,label:u,scale:i})}var c=(new Plottable.Plots.ClusteredBar).x(function(e){return e.x},w).y(function(e){return e.y},i).attr("fill",function(e){return Q(e)});L.push(c);for(var d=0;W>d;d++)c.addDataset(d===L.length-1?a:new Plottable.Dataset([]));var h=I.axisConfigurations(),f=[];h.forEach(function(e){("day"===e[0].interval||"month"===e[0].interval||"year"===e[0].interval)&&f.push(e)}),I.axisConfigurations(f),S.push(c)}else{var p=(new Plottable.Plots.Line).x(function(e){return e.x},w).y(function(e){return e.y},E).attr("stroke",n.chart.lineColor).attr("stroke-width",s);p.addDataset(a),H.addDataset(a),S.push(p)}}}),S.push(H);var K=null,G=null;if(W>0){K=new Plottable.Scales.Color,G=new Plottable.Components.Legend(K);var q=[],J=[];d3.entries(m).forEach(function(e){var t=e.key,a=_(t),n=a.seriesName,i=a.chart.barColor;n&&i&&(q.push(n),J.push(i))}),K.domain(q),K.range(J),G.maxEntriesPerRow(2),G.symbol(Plottable.SymbolFactories.square),G.xAlignment("right"),G.yAlignment("top"),S.push(G)}if(y.panZoom.enabled&&y.panZoom.showHint){var X=new Plottable.Components.Label("( Drag chart to pan, pinch or scroll to zoom )",0).padding(10).yAlignment("bottom").xAlignment("right").addClass("zoom-hint-label"),$=((new Plottable.Interactions.Click).attachTo(X).onClick(function(e){$()}),function(){X.addClass("hidden")});S.push(X)}var ee=new Plottable.Components.Group(S),te=new Plottable.Components.Group([A,C]),ae=[te,ee],ne=[null,I];B.forEach(function(e){ae.push(new Plottable.Components.Group([e.axis,e.label])),ne.push(null)}),f=new Plottable.Components.Table([ae,ne]),f.yAlignment("bottom"),O.attachTo(f);var ie=T.chart.daysShownOnTimeline,oe=ie?ie.min:!1,re=ie?ie.max:!1,se=null,le=null;if(y.panZoom.enabled&&(se=new Plottable.Interactions.PanZoom,se.addXScale(w),se.attachTo(ee),le=new Plottable.Interactions.PanZoom,le.addXScale(w),le.attachTo(I),oe&&(se.minDomainExtent(w,oe*o),le.minDomainExtent(w,oe*o)),re&&(se.maxDomainExtent(w,re*o),le.maxDomainExtent(w,re*o))),re){var ue=[];d3.entries(m).forEach(function(e){var t=e.value;t.forEach(function(e){ue.push(e.x)})});var me=w.extentOfValues(ue),ce=me[1].getTime()-me[0].getTime(),de=re*o;ce>de&&(me[1]=new Date(me[0].getTime()+de)),w.domain(me)}var he=function(e){oe&&(e=Math.max(e,oe)),re&&(e=Math.min(e,re));var t=w.domain(),a=[t[0],new Date(t[0].getTime()+e*o)];w.domain(a)},fe=function(e){var t=w.domain();timeInDays=(t[1].getTime()-t[0].getTime())/o,timeInDays*=(100-e)/100,oe&&(timeInDays=Math.max(timeInDays,oe)),re&&(timeInDays=Math.min(timeInDays,re));var a=[t[0],new Date(t[0].getTime()+timeInDays*o)];w.domain(a)},pe=function(e){var t=w.domain();timeInDays=(t[1].getTime()-t[0].getTime())/o,timeInDays*=e/100;var a=[new Date(t[0].getTime()+timeInDays*o),new Date(t[1].getTime()+timeInDays*o)];w.domain(a)},ve=function(){d3.selectAll(".time-button").classed("active",!1)},be=null;if(y.toolbar.enabled){if(be=t.append("div").classed("omh-chart-toolbar",!0).attr("unselectable","on"),y.timespanButtons.enabled){var ge={"1wk":7,"1m":30,"3m":90,"6m":180};be.append("span").classed("time-buttons-label",!0).text("Show: "),d3.entries(ge).forEach(function(e){var t=e.value,a=e.key;if((!re||re>=t)&&(!oe||t>=oe)){var n=be.append("span").classed("time-button",!0).text(a);n.on("click",function(){ve(),he(t),d3.select(this).classed("active",!0)})}})}if(y.zoomButtons.enabled){var ye={"&#8722;":-20,"&#43;":20};be.append("span").classed("zoom-buttons-label",!0).text(" Zoom: "),d3.entries(ye).forEach(function(e){var t=e.value,a=e.key,n=be.append("span").classed("zoom-button",!0).html(a);n.on("click",function(){ve(),fe(t)})})}if(y.navigation.enabled){var _e=be.append("span",":first-child").classed("previous-time-period-button",!0).text("< prev");_e.on("click",function(){pe(-100)});var xe=be.append("span").classed("next-time-period-button",!0).text("next >");xe.on("click",function(){pe(100)})}}var De=H.datasets(),Te=De&&De.length>0;if(y.tooltips.enabled&&Te){var we=null,Ee=function(e){e.selection.style("opacity","1")},Pe=function(e){e.selection.style("opacity",r)},Ne=function(e,t){h[e][t].forEach(function(e){Ee(e)})},Ie=function(e,t){h[e][t].forEach(function(e){Pe(e)})},Ae=function(e){Ze.show(e.datum,e.selection[0][0])},Ce=function(e){e&&u&&(e.selection[0][0].getBoundingClientRect().left>u[0][0].getBoundingClientRect().left&&e.selection[0][0].getBoundingClientRect().right<u[0][0].getBoundingClientRect().right?Ae(e):Ze.hide())},Oe=function(){if(we&&u)if(we.datum.hasTooltip)Ce(we);else{var e=d[we.datum.omhDatum.groupName][we.index],t=d3.select(".d3-tip").node().clientHeight;Ce(e.selection[0][0].getBoundingClientRect().top>u[0][0].getBoundingClientRect().top+t?e:we)}},Me=function(e){null!==we?e.datum.omhDatum.body!==we.datum.omhDatum.body&&(Ie(we.datum.omhDatum.groupName,we.index),we=e,Ne(we.datum.omhDatum.groupName,e.index)):we=e,null===e.datum},Ue=new Plottable.Interactions.Pointer;Ue.onPointerExit(function(e){Ze.hide()}),Ue.onPointerEnter(Oe.bind(this));var Se=function(e){var t;try{t=H.entityNearest(e)}catch(a){return}Me(t),Oe()}.bind(this);Ue.onPointerMove(Se),Ue.attachTo(H);var ze=function(e,t){var a,n="value";if(z(e)&&(n+=" above-threshold"),"_systolic_blood_pressure_diastolic_blood_pressure"===e.omhDatum.groupName){var i=e.omhDatum.body.systolic_blood_pressure.value.toFixed(0),o=e.omhDatum.body.diastolic_blood_pressure.value.toFixed(0);a='<div class="'+n+'">'+i+"/"+o+"</div>"}else a="_heart_rate"===e.omhDatum.groupName?'<div class="'+n+'">'+e.y.toFixed(0)+"</div>":'<div class="'+n+'">'+e.y.toFixed(1)+"</div>";var r=y.tooltips.timeFormat;return a+='<div class="time">'+moment(e.x).format(r)+"</div>",a+='<div class="provider">'+e.provider+"</div>"},Ze=d3.tip().attr("class","d3-tip").html(function(e){return'<div class="omh-tooltip">'+ze(e,n)+"</div>"})}this.renderTo=function(e){return this.initialized?(u=d3.select(e),Ze&&u.call(Ze),p&&p.offWheel(U),p=new Plottable.Dispatchers.Mouse.getDispatcher(u[0][0]).onWheel(U),f.renderTo(u),d={},h={},void H.entities().forEach(function(e){var t=e.datum.omhDatum.groupName;d[t]||(d[t]=[]),e.datum.hasTooltip&&(d[t][e.index]=e),h[t]||(h[t]=[]),h[t][e.index]||(h[t][e.index]=[]),h[t][e.index].push(e)})):void console.log("Warning: chart could not be rendered because it was not successfully initialized.")},this.initialized=!0},a});