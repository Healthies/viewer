!function(e,t){var a="OMHWebVisualizations";e[a]=t(e,a),e[a].QUANTIZE_YEAR=6,e[a].QUANTIZE_MONTH=5,e[a].QUANTIZE_DAY=4,e[a].QUANTIZE_HOUR=3,e[a].QUANTIZE_MINUTE=2,e[a].QUANTIZE_SECOND=1,e[a].QUANTIZE_MILLISECOND=0,e[a].QUANTIZE_NONE=-1,e[a].Utils={},e[a].Utils.mergeObjects=function(t,n){function o(o){if(void 0===i[o]){var r=t[o],l=n[o];typeof r!=typeof l||"object"!=typeof r||l instanceof Array?(i[o]=r,n.hasOwnProperty(o)&&(i[o]=l)):i[o]=e[a].Utils.mergeObjects(r||{},l||{})}}var i={};for(var r in t)o(r);for(r in n)o(r);return i}}(this,function(e,t){var a=e.hasOwnProperty(t)?e[t]:{};return a.Chart=function(e,t,n,o){var r=864e5,l=.5,s="1px",u="1px";this.initialized=!1,"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]),t.node||(t=d3.select(t)),o||(o={});var m=null;t.classed("omh-chart-container",!0);var c=null,d=n.split(/\s*,\s*/),f={},h={},p=null,v=null,b=function(e){var t;if("_systolic_blood_pressure_diastolic_blood_pressure"===e.omhDatum.groupName){var a=e.omhDatum.body.systolic_blood_pressure.value.toFixed(0),n=e.omhDatum.body.diastolic_blood_pressure.value.toFixed(0);t=a+"/"+n}else{var o="undefined"!=typeof x.userInterface.decimalPlaces?x.userInterface.decimalPlaces:1;t=e.y.toFixed(o)}return t},g={userInterface:{toolbar:{enabled:!0},timespanButtons:{enabled:!0},zoomButtons:{enabled:!0},navigation:{enabled:!0},thresholds:{show:!0},tooltips:{enabled:!0,timeFormat:"M/D/YY, h:mma",decimalPlaces:0,contentFormatter:b,grouped:!0},panZoom:{enabled:!0,showHint:!0},axes:{yAxis:{visible:!0},xAxis:{visible:!0}}},measures:{body_weight:{valueKeyPath:"body.body_weight.value",range:{min:0,max:100},units:"kg",thresholds:{max:57}},heart_rate:{valueKeyPath:"body.heart_rate.value",range:{min:30,max:150},units:"bpm"},step_count:{valueKeyPath:"body.step_count",range:{min:0,max:1500},units:"Steps",seriesName:"Steps",timeQuantizationLevel:a.QUANTIZE_DAY,chart:{type:"clustered_bar",barColor:"#eeeeee",daysShownOnTimeline:{min:7,max:90}}},minutes_moderate_activity:{valueKeyPath:"body.minutes_moderate_activity.value",range:{min:0,max:300},units:"Minutes",seriesName:"Minutes of moderate activity",timeQuantizationLevel:a.QUANTIZE_DAY,chart:{type:"clustered_bar",daysShownOnTimeline:{min:7,max:90}}},systolic_blood_pressure:{valueKeyPath:"body.systolic_blood_pressure.value",range:{min:30,max:200},units:"mmHg",thresholds:{max:120}},diastolic_blood_pressure:{valueKeyPath:"body.diastolic_blood_pressure.value",range:{min:30,max:200},units:"mmHg",thresholds:{max:80}}}},y={range:{min:0,max:100},units:"Units",seriesName:"Series",timeQuantizationLevel:a.QUANTIZE_NONE,chart:{type:"line",pointSize:9,lineColor:"#dedede",pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6",aboveThesholdPointFillColor:"#e8ac4e",aboveThesholdPointStrokeColor:"#745628",barColor:"#4a90e2",daysShownOnTimeline:{min:1,max:1e3}}};this.destroy=function(){Le&&Le.offPointerMove(Fe),Le&&Le.detachFrom(V),U&&U.detachFrom(p),p&&p.destroy(),Be&&Be.destroy(),v&&v.offWheel(k),Qe&&U.offDrag(Qe),we&&we.remove(),C&&I.offUpdate(C)},this.getComponents=function(){if(!this.initialized)return{};var e={};e[d[0]]=I;var t={};t[d[0]]=O;var a={};a[d[0]]=M;var n={};n[d[0]]=E;var o={};o[d[0]]=N;var i={};return i[d[0]]=$,Y.forEach(function(n){e[n.measure]=n.scale,t[n.measure]=n.axis,a[n.measure]=n.label}),{xScales:n,yScales:e,colorScales:i,gridlines:null,legends:[ee],xAxes:o,yAxes:t,plots:B,yLabels:a,table:p,tooltip:Be,toolbar:we,panZoomInteractions:{plotGroup:he,xAxis:pe}}},this.getD3Selection=function(){return m};var x=a.Utils.mergeObjects(g,o);d3.keys(x.measures).forEach(function(e){x.measures[e]=a.Utils.mergeObjects(y,x.measures[e])});var _=x.userInterface,D=function(e){return x.measures[e]},T={},w=function(e,t){if(void 0===e)return e;var a;"string"==typeof t?(T[t]||(T[t]=t.split(".")),a=T[t].slice()):a=t;try{if(t&&a.length>0)return w(e[a.shift()],a)}catch(n){console.info("Exception while resolving keypath",n)}return e};if(this.getIntervalDisplayDate=function(e,t,a){var n=e.body.effective_time_frame.time_interval,o=n.start_date_time?new Date(n.start_date_time).getTime():null,i=n.end_date_time?new Date(n.end_date_time).getTime():null,r=n.start_date_time?t(n.start_date_time):null,l=n.end_date_time?t(n.end_date_time):null,s={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},u=n.duration?n.duration.value:null;if(u){var m,c=n.duration.unit,d=s[c];"string"!=typeof d?(m=u*d,o||(o=i-m),i||(i=o+m)):(o||(o=l.subtract(u,s[c]).valueOf()),i||(i=r.add(u,s[c]).valueOf()))}var f=new Date(o),h=a<=OMHWebVisualizations.QUANTIZE_MONTH?f.getMonth():6,p=a<=OMHWebVisualizations.QUANTIZE_DAY?f.getDate():a===OMHWebVisualizations.QUANTIZE_MONTH?15:1,v=a<=OMHWebVisualizations.QUANTIZE_HOUR?f.getHours():a===OMHWebVisualizations.QUANTIZE_DAY?12:0,b=a<=OMHWebVisualizations.QUANTIZE_MINUTE?f.getMinutes():a===OMHWebVisualizations.QUANTIZE_HOUR?30:0,g=a<=OMHWebVisualizations.QUANTIZE_SECOND?f.getSeconds():a===OMHWebVisualizations.QUANTIZE_MINUTE?30:0,y=a<=OMHWebVisualizations.QUANTIZE_MILLISECOND?f.getMilliseconds():a===OMHWebVisualizations.QUANTIZE_SECOND?500:0,x=new Date(f.getFullYear(),h,p,v,b,g,y);return x},this.parseOmhData=function(e,t,a){var n={},o=this;return e&&0!==e.length?(e.forEach(function(e){e.groupName="",t.forEach(function(t,i){var r=D(t).valueKeyPath,l=w(e,r);if(void 0!==l&&"object"!=typeof l){e.groupName+="_"+t,n.hasOwnProperty(t)||(n[t]=[]);var s;if(e.body.effective_time_frame.date_time&&(s=new Date(e.body.effective_time_frame.date_time)),e.body.effective_time_frame.time_interval){var u=D(t).timeQuantizationLevel;s=o.getIntervalDisplayDate(e,a,u)}var m=D(t).valueKeyPath,c=w(e,m);n[t].push({y:c,x:s,provider:e.header.acquisition_provenance.source_name,omhDatum:e,hasTooltip:0===i,measure:t})}})}),n):n},dataCopy=JSON.parse(JSON.stringify(e)),c=this.parseOmhData(dataCopy,d,moment),0===Object.keys(c).length)return void console.log("Warning: no data of the specified type could be found.");this.consolidateData=function(e){e.sort(function(e,t){return e.x.getTime()-t.x.getTime()});for(var t=0;t<e.length;t++)for(;t+1<e.length&&e[t+1].x.getTime()===e[t].x.getTime();)e[t].y+=e[t+1].y,e[t].accumulatedDataBodies||(e[t].accumulatedDataBodies=[e[t].omhDatum.body]),e[t].accumulatedDataBodies.push(e[t+1].omhDatum.body),e.splice(t+1,1)},c.minutes_moderate_activity&&this.consolidateData(c.minutes_moderate_activity),c.step_count&&this.consolidateData(c.step_count);var P=D(d[0]),E=new Plottable.Scales.Time,I=new Plottable.Scales.Linear,C=null,A=P.range;A&&I.domainMin(A.min).domainMax(A.max);var N=new Plottable.Axes.Time(E,"bottom").margin(15).addClass("x-axis"),O=new Plottable.Axes.Numeric(I,"left"),M=new Plottable.Components.AxisLabel(P.units,"0").padding(5).xAlignment("right").yAlignment("top"),U=new Plottable.Interactions.Drag,S=function(){oe&&oe(),Be&&Qe&&Qe()};U.onDrag(S);var k=function(){Qe&&Qe(),Te&&Te(),oe&&oe()},z={},Z={},Q=function(e){var t={name:"normal",color:"_default"},a={color:"_aboveThreshold",name:"above-threshold"},n=z[e.measure],o=Z[e.measure];if(!n&&!o||0===n.length&&0===o.length)return t;var i=function(e){if(0===n.length)return t;for(var o=0;o<n.length;o++){var i=n[o];if(i&&(!i.min||e.y>i.min))return i}return a},r=function(e){if(0===o.length)return t;for(var n=0;n<o.length;n++){var i=o[n];if(i&&(!i.max||e.y<=i.max))return i}return a},l=r(e);if(l){if(l.hasOwnProperty("name")&&"normal"===l.name){var s=i(e);return s?s:t}if(l)return l}return a},H=function(e,t){var a=D(e.measure).chart,n={fill:a.pointFillColor,stroke:a.pointStrokeColor},o={fill:a.aboveThesholdPointFillColor,stroke:a.aboveThesholdPointStrokeColor};return t&&t.color?"_default"==t.color?n:"_aboveThreshold"==t.color?o:"string"==typeof t.color?{fill:t.color,stroke:t.color}:t.color:n},L=function(e){var t=H(e,Q(e));return t.fill},F=function(e){var t=H(e,Q(e));return t.stroke},W=function(e){return D(e.measure).chart.barColor},B=[],V=(new Plottable.Plots.Scatter).x(function(e){return e.x},E).y(function(e){return e.y},I).size(function(e){return D(e.measure).chart.pointSize}).attr("fill",function(e){return L(e)}).attr("opacity",l).attr("stroke-width",u).attr("stroke",function(e){return F(e)}),R=[],j=0,Y=[];if(d3.entries(c).forEach(function(e){var t=e.key;"clustered_bar"===D(t).chart.type&&j++}),_.thresholds.show){var K=[];if(d3.entries(c).forEach(function(e){var t=e.key,a=D(t).thresholds;Array.isArray(a)||(a=[a]);var n=function(e){return function(t){return t.hasOwnProperty(e)}},o=function(e){return function(t,a){return"min"===e?a.min-t.min:t.max-a.max}},r=a.filter(n("max")).sort(o("max")),l=a.filter(n("min")).sort(o("min"));if(r.length>0&&(r[0].color="_default",r[0].name="normal"),l.length>0&&(l[0].color="_default",r[0].name="normal"),Z[t]=r,z[t]=l,a)for(i=0;i<a.length;i++){var s=a[i];s.max&&-1==K.indexOf(s.max)&&K.push(s.max),s.min&&-1==K.indexOf(s.min)&&K.push(s.min)}}),K.length>0){K.sort(function(e,t){return e-t});var G=new Plottable.Scales.Linear;G.domain(I.domain()),G.range(I.range()),C=function(e){G.domain(e.domain()),G.range(e.range())},I.onUpdate(C);var q=function(e){var t=(e.domain(),K);return t};G.tickGenerator(q);var J=new Plottable.Axes.Numeric(G,"right").tickLabelPosition("top").tickLabelPadding(3).showEndTickLabels(!0).addClass("gridlines-axis"),X=new Plottable.Components.Gridlines(null,G);B.push(X),B.push(J)}}d.forEach(function(e){if(c.hasOwnProperty(e)){var t=c[e],a=new Plottable.Dataset(t),n=D(e);if(a.measure=e,"clustered_bar"===n.chart.type){var o=I;if(R.length>0){var i=n.range,r=n.units;o=(new Plottable.Scales.Linear).domainMin(i.min).domainMax(i.max);var l=new Plottable.Axes.Numeric(o,"right"),u=new Plottable.Components.AxisLabel(r,"0").padding(5).xAlignment("left").yAlignment("top");Y.push({measure:e,axis:l,label:u,scale:o})}var m=(new Plottable.Plots.ClusteredBar).x(function(e){return e.x},E).y(function(e){return e.y},o).attr("fill",function(e){return W(e)});R.push(m);for(var d=0;j>d;d++)m.addDataset(d===R.length-1?a:new Plottable.Dataset([]));var f=N.axisConfigurations(),h=[];f.forEach(function(e){("day"===e[0].interval||"month"===e[0].interval||"year"===e[0].interval)&&h.push(e)}),N.axisConfigurations(h),m.addClass("clustered-bar-plot-"+e),B.push(m)}else{var p=(new Plottable.Plots.Line).x(function(e){return e.x},E).y(function(e){return e.y},I).attr("stroke",n.chart.lineColor).attr("stroke-width",s);p.addDataset(a),V.addDataset(a),p.addClass("line-plot-"+e),B.push(p)}}}),V.addClass("point-plot"),B.push(V);var $=null,ee=null;if(x.userInterface.legend){$=new Plottable.Scales.Color,ee=new Plottable.Components.Legend($);var te=[],ae=[];d3.entries(c).forEach(function(e){var t,a=e.key,n=D(a),o=n.seriesName,i=n.chart.type;switch(i){case"clustered_bar":t=n.chart.barColor;break;default:t=n.chart.pointFillColor}o&&t&&(te.push(o),ae.push(t))}),$.domain(te),$.range(ae),ee.maxEntriesPerRow(2),ee.symbol(Plottable.SymbolFactories.square),ee.xAlignment("right"),ee.yAlignment("top"),B.push(ee)}if(_.panZoom.enabled&&_.panZoom.showHint){var ne=new Plottable.Components.Label("( Drag chart to pan, pinch or scroll to zoom )",0).padding(10).yAlignment("bottom").xAlignment("right").addClass("zoom-hint-label"),oe=((new Plottable.Interactions.Click).attachTo(ne).onClick(function(e){oe()}),function(){ne.addClass("hidden")});B.push(ne)}var ie=_.axes.xAxis.visible,re=_.axes.yAxis.visible,le=new Plottable.Components.Group(B),se=re?new Plottable.Components.Group([O,M]):null,ue=[se,le],me=[null,ie?N:null];re&&Y.forEach(function(e){ue.push(new Plottable.Components.Group([e.axis,e.label])),me.push(null)}),p=new Plottable.Components.Table([ue,me]),p.yAlignment("bottom"),U.attachTo(p);var ce=P.chart.daysShownOnTimeline,de=ce?ce.min:!1,fe=ce?ce.max:!1,he=null,pe=null;if(_.panZoom.enabled&&(he=new Plottable.Interactions.PanZoom,he.addXScale(E),he.attachTo(le),pe=new Plottable.Interactions.PanZoom,pe.addXScale(E),pe.attachTo(N),de&&(he.minDomainExtent(E,de*r),pe.minDomainExtent(E,de*r)),fe&&(he.maxDomainExtent(E,fe*r),pe.maxDomainExtent(E,fe*r))),fe){var ve=[];d3.entries(c).forEach(function(e){var t=e.value;t.forEach(function(e){ve.push(e.x)})});var be=E.extentOfValues(ve),ge=be[1].getTime()-be[0].getTime(),ye=fe*r;ge>ye&&(be[1]=new Date(be[0].getTime()+ye)),E.domain(be)}var xe=function(e){de&&(e=Math.max(e,de)),fe&&(e=Math.min(e,fe));var t=E.domain(),a=[t[0],new Date(t[0].getTime()+e*r)];E.domain(a)},_e=function(e){var t=E.domain();timeInDays=(t[1].getTime()-t[0].getTime())/r,timeInDays*=(100-e)/100,de&&(timeInDays=Math.max(timeInDays,de)),fe&&(timeInDays=Math.min(timeInDays,fe));var a=[t[0],new Date(t[0].getTime()+timeInDays*r)];E.domain(a)},De=function(e){var t=E.domain();timeInDays=(t[1].getTime()-t[0].getTime())/r,timeInDays*=e/100;var a=[new Date(t[0].getTime()+timeInDays*r),new Date(t[1].getTime()+timeInDays*r)];E.domain(a)},Te=function(){d3.selectAll(".time-button").classed("active",!1)},we=null;if(_.toolbar.enabled){if(we=t.append("div").classed("omh-chart-toolbar",!0).attr("unselectable","on"),_.timespanButtons.enabled){var Pe={"1wk":7,"1m":30,"3m":90,"6m":180};we.append("span").classed("time-buttons-label",!0).text("Show: "),d3.entries(Pe).forEach(function(e){var t=e.value,a=e.key;if((!fe||fe>=t)&&(!de||t>=de)){var n=we.append("span").classed("time-button",!0).text(a);n.on("click",function(){Te(),xe(t),d3.select(this).classed("active",!0)})}})}if(_.zoomButtons.enabled){var Ee={"&#8722;":-20,"&#43;":20};we.append("span").classed("zoom-buttons-label",!0).text(" Zoom: "),d3.entries(Ee).forEach(function(e){var t=e.value,a=e.key,n=we.append("span").classed("zoom-button",!0).html(a);n.on("click",function(){Te(),_e(t)})})}if(_.navigation.enabled){var Ie=we.append("span",":first-child").classed("previous-time-period-button",!0).text("< prev");Ie.on("click",function(){De(-100)});var Ce=we.append("span").classed("next-time-period-button",!0).text("next >");Ce.on("click",function(){De(100)})}}var Ae=V.datasets(),Ne=Ae&&Ae.length>0;if(_.tooltips.enabled&&Ne){var Oe=null,Me=function(e){e.selection.style("opacity","1")},Ue=function(e){e.selection.style("opacity",l)},Se=function(e,t){h[e][t].forEach(function(e){Me(e)})},ke=function(e,t){h[e][t].forEach(function(e){Ue(e)})},ze=function(e){Be.show(e.datum,e.selection[0][0])},Ze=function(e){e&&m&&(e.selection[0][0].getBoundingClientRect().left>m[0][0].getBoundingClientRect().left&&e.selection[0][0].getBoundingClientRect().right<m[0][0].getBoundingClientRect().right?ze(e):Be.hide())},Qe=function(){if(Oe&&m)if(Oe.datum.hasTooltip||!_.tooltips.grouped)Ze(Oe);else{var e=f[Oe.datum.omhDatum.groupName][Oe.index],t=d3.select(".d3-tip").node().clientHeight;Ze(e.selection[0][0].getBoundingClientRect().top>m[0][0].getBoundingClientRect().top+t?e:Oe)}},He=function(e){if(null!==Oe){var t=_.tooltips.grouped,a=e.datum.omhDatum.body!==Oe.datum.omhDatum.body,n=e.datum.measure!==Oe.datum.measure,o=t?a:a||n;o&&(ke(Oe.datum.omhDatum.groupName,Oe.index),Oe=e,Se(Oe.datum.omhDatum.groupName,e.index))}else Oe=e;null===e.datum},Le=new Plottable.Interactions.Pointer;Le.onPointerExit(function(e){Be.hide()}),Le.onPointerEnter(Qe.bind(this));var Fe=function(e){var t;try{t=V.entityNearest(e),He(t),Qe()}catch(a){return}}.bind(this);Le.onPointerMove(Fe),Le.attachTo(V);var We=function(e,t){var a,n="value",o=Q(e);if(o&&(o.cssClass||o.name)){var i=o.cssClass?o.cssClass:o.name;i=i.toLowerCase().replace(/[^a-z0-9-]+/g,"_"),n+=" threshold-"+i+" threshold-"+e.measure+"-"+i}var r;if(x.userInterface.tooltips&&"undefined"!=typeof x.userInterface.tooltips.contentFormatter)r=x.userInterface.tooltips.contentFormatter(e);else{var l="undefined"!=typeof x.userInterface.decimalPlaces?x.userInterface.decimalPlaces:1;r=e.y.toFixed(l)}a='<div class="'+n+'">'+r+"</div>";var s=_.tooltips.timeFormat;return a+='<div class="time">'+moment(e.x).format(s)+"</div>",a+='<div class="provider">'+e.provider+"</div>"},Be=d3.tip().attr("class","d3-tip").html(function(e){return'<div class="omh-tooltip">'+We(e,n)+"</div>"})}this.renderTo=function(e){return this.initialized?(m=d3.select(e),Be&&m.call(Be),v&&v.offWheel(k),v=new Plottable.Dispatchers.Mouse.getDispatcher(m[0][0]).onWheel(k),p.renderTo(m),f={},h={},void V.entities().forEach(function(e){var t=e.datum.omhDatum.groupName;f[t]||(f[t]=[]),e.datum.hasTooltip&&(f[t][e.index]=e),h[t]||(h[t]=[]),h[t][e.index]||(h[t][e.index]=[]),h[t][e.index].push(e)})):void console.log("Warning: chart could not be rendered because it was not successfully initialized.")},this.initialized=!0},a});