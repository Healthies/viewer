!function(e,t){var n="OMHWebVisualizations";e[n]=t(e,n)}(this,function(e,t){var n=e.hasOwnProperty(t)?e[t]:{};return n.Chart=function(e,t,n,a){var i,o=n.split(/\s*,\s*/),r=null,s=new OMHWebVisualizations.ChartConfiguration(o,a),l=new OMHWebVisualizations.DataParser(e,o,s),u=new OMHWebVisualizations.ChartStyles(s),c=new OMHWebVisualizations.ChartInteractions(t,s,l,u);this.initialized=!1,"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]),t.node||(t=d3.select(t)),a||(a={}),t.classed("omh-chart-container",!0),this.destroy=function(){c.destroy(),r&&r.destroy(),h&&g.offUpdate(h)},this.getComponents=function(){if(!this.initialized)return{};var e={};e[o[0]]=g;var t={};t[o[0]]=p;var n={};n[o[0]]=b;var a={};a[o[0]]=d;var i={};i[o[0]]=m;var s={};return s[o[0]]=L,w.forEach(function(a){e[a.measure]=a.scale,t[a.measure]=a.axis,n[a.measure]=a.label}),{xScales:a,yScales:e,colorScales:s,gridlines:{gridlines:S,yAxis:C,values:A},legends:[z],xAxes:i,yAxes:t,plots:x,yLabels:n,table:r,tooltip:c.getTooltip(),toolbar:c.getToolbar(),panZoomInteractions:{plotGroup:c.getPanZoomInteraction(),xAxis:c.getpanZoomInteractionXAxis()}}},this.getMeasures=function(){return o},this.getStyles=function(){return u},this.getInteractions=function(){return c},this.getConfiguration=function(){return s},this.getParser=function(){return l},this.getD3Selection=function(){return i};var d=new Plottable.Scales.Time,g=new Plottable.Scales.Linear,h=null,f=s.getPrimaryMeasureSettings().range;f&&g.domainMin(f.min).domainMax(f.max);var m=new Plottable.Axes.Time(d,"bottom").margin(15).addClass("x-axis"),p=new Plottable.Axes.Numeric(g,"left"),b=new Plottable.Components.AxisLabel(s.getPrimaryMeasureSettings().units,"0").padding(5).xAlignment("right").yAlignment("top"),x=[],y=(new Plottable.Plots.Scatter).x(function(e){return e.x},d).y(function(e){return e.y},g);u.setStylesForPlot(u.getDefaultStylesForPlot(y),y);var P=[],v=0,w=[];d3.entries(l.getAllMeasureData()).forEach(function(e){var t=e.key;"clustered_bar"===s.getMeasureSettings(t).chart.type&&v++});var S,C,A=[],M=function(e){e.max&&A.push(e.max),e.min&&A.push(e.min)};if(s.getInterfaceSettings().thresholds.show!==!1&&(o.forEach(function(e){var t=s.getMeasureSettings(e).thresholds;t&&M(t)}),A.length>0)){A.sort(function(e,t){return e-t});var D=new Plottable.Scales.Linear;D.domain(g.domain()),D.range(g.range()),h=function(e){D.domain(e.domain()),D.range(e.range())},g.onUpdate(h);var T=function(e){var t=A;return t};D.tickGenerator(T),C=new Plottable.Axes.Numeric(D,"right").tickLabelPosition("top").tickLabelPadding(1).showEndTickLabels(!0).addClass("gridlines-axis"),S=new Plottable.Components.Gridlines(null,D),x.push(S),x.push(C)}o.forEach(function(e){if(l.hasMeasureData(e)){var t=l.getMeasureData(e),n=new Plottable.Dataset(t),a=s.getMeasureSettings(e);if(n.measure=e,"clustered_bar"===a.chart.type){var i=g;if(P.length>0){var o=a.range,r=a.units;i=(new Plottable.Scales.Linear).domainMin(o.min).domainMax(o.max);var c=new Plottable.Axes.Numeric(i,"right"),h=new Plottable.Components.AxisLabel(r,"0").padding(5).xAlignment("left").yAlignment("top");w.push({measure:e,axis:c,label:h,scale:i})}var f=(new Plottable.Plots.ClusteredBar).x(function(e){return e.x},d).y(function(e){return e.y},i);u.setStylesForPlot(u.getDefaultStylesForPlot(f),f),P.push(f);for(var p=0;v>p;p++)f.addDataset(p===P.length-1?n:new Plottable.Dataset([]));var b=m.axisConfigurations(),S=[];b.forEach(function(e){("day"===e[0].interval||"month"===e[0].interval||"year"===e[0].interval)&&S.push(e)}),m.axisConfigurations(S),f.addClass("clustered-bar-plot-"+e),x.push(f)}else{var C=(new Plottable.Plots.Line).x(function(e){return e.x},d).y(function(e){return e.y},g);u.setStylesForPlot(u.getDefaultStylesForPlot(C),C),C.addDataset(n),y.addDataset(n),C.addClass("line-plot-"+e),x.push(C)}}}),y.addClass("point-plot"),x.push(y);var L=null,z=null;if(s.getInterfaceSettings().legend){L=new Plottable.Scales.Color,z=new Plottable.Components.Legend(L);var E=[],I=[];d3.entries(l.getAllMeasureData()).forEach(function(e){var t,n=e.key,a=s.getMeasureSettings(n),i=a.seriesName,o=a.chart.type;switch(o){case"clustered_bar":t=a.chart.barColor;break;default:t=a.chart.pointFillColor}i&&t&&(E.push(i),I.push(t))}),L.domain(E),L.range(I),z.maxEntriesPerRow(2),z.symbol(Plottable.SymbolFactories.square),z.xAlignment("right"),z.yAlignment("top"),x.push(z)}var F=s.getInterfaceSettings().axes.xAxis.visible,k=s.getInterfaceSettings().axes.yAxis.visible,G=new Plottable.Components.Group(x),O=k?new Plottable.Components.Group([p,b]):null,W=[O,G],H=[null,F?m:null];k&&w.forEach(function(e){W.push(new Plottable.Components.Group([e.axis,e.label])),H.push(null)}),r=new Plottable.Components.Table([W,H]),r.yAlignment("bottom"),c.addToComponents({plots:x,plotGroup:G,table:r,xScale:d,xAxis:m}),this.renderTo=function(e){return this.initialized?(i=d3.select(e),c.addToSelection(i),r.renderTo(i),u.addToSelection(i),void c.addTooltipsToEntities(y.entities())):void console.log("Warning: chart could not be rendered because it was not successfully initialized.")},this.initialized=!0},n});