!function(a,e){var t="OMHWebVisualizations";a[t]=e(a,t)}(this,function(a,e){var t=a.hasOwnProperty(e)?a[e]:{};return t.DataParser=function(a,e,t){var i=null,r={},n={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},s=function(){var t=JSON.parse(JSON.stringify(a));return i=this.parseOmhData(t,e,moment),0===Object.keys(i).length?(console.log("Warning: no data of the specified type could be found."),!1):void 0};return this.resolveKeyPath=function(a,e){if(void 0===a)return a;var t;"string"==typeof e?(r[e]||(r[e]=e.split(".")),t=r[e].slice()):t=e;try{if(e&&t.length>0)return this.resolveKeyPath(a[t.shift()],t)}catch(i){console.info("Exception while resolving keypath",i)}return a},this.getIntervalDisplayDate=function(a,e,t){var i=a.body.effective_time_frame.time_interval,r=i.start_date_time?new Date(i.start_date_time).getTime():null,s=i.end_date_time?new Date(i.end_date_time).getTime():null,o=i.start_date_time?e(i.start_date_time):null,u=i.end_date_time?e(i.end_date_time):null,l=i.duration?i.duration.value:null;if(l){var D,c=i.duration.unit,d=n[c];"string"!=typeof d?(D=l*d,r||(r=s-D),s||(s=r+D)):(r||(r=u.subtract(l,n[c]).valueOf()),s||(s=o.add(l,n[c]).valueOf()))}return new Date(r)},this.quantizeDate=function(a,e){var t=e<=OMHWebVisualizations.DataParser.QUANTIZE_MONTH?a.getMonth():6,i=e<=OMHWebVisualizations.DataParser.QUANTIZE_DAY?a.getDate():e===OMHWebVisualizations.DataParser.QUANTIZE_MONTH?15:1,r=e<=OMHWebVisualizations.DataParser.QUANTIZE_HOUR?a.getHours():e===OMHWebVisualizations.DataParser.QUANTIZE_DAY?12:0,n=e<=OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?a.getMinutes():e===OMHWebVisualizations.DataParser.QUANTIZE_HOUR?30:0,s=e<=OMHWebVisualizations.DataParser.QUANTIZE_SECOND?a.getSeconds():e===OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?30:0,o=e<=OMHWebVisualizations.DataParser.QUANTIZE_MILLISECOND?a.getMilliseconds():e===OMHWebVisualizations.DataParser.QUANTIZE_SECOND?500:0;return new Date(a.getFullYear(),t,i,r,n,s,o)},this.parseOmhData=function(a,e,i){var r=this,n={},s={},o={};return a&&0!==a.length?(e.forEach(function(a,e){s[a]=t.getMeasureSettings(a).timeQuantizationLevel,o[a]=t.getMeasureSettings(a).valueKeyPath}),a.forEach(function(a){a.groupName="",e.forEach(function(e,t){var u=r.resolveKeyPath(a,o[e]);if(void 0!==u&&"object"!=typeof u){a.groupName+="_"+e,n.hasOwnProperty(e)||(n[e]=[]);var l;a.body.effective_time_frame.date_time&&(l=r.quantizeDate(new Date(a.body.effective_time_frame.date_time),s[e])),a.body.effective_time_frame.time_interval&&(l=r.quantizeDate(r.getIntervalDisplayDate(a,i),s[e])),n[e].push({y:u,x:l,provider:a.header.acquisition_provenance.source_name,omhDatum:a,primary:0===t,measure:e})}})}),e.forEach(function(a,e){s[a]!==OMHWebVisualizations.DataParser.QUANTIZE_NONE&&r.consolidateData(a,n)}),n):n},this.consolidateData=function(a,e){var i=t.getMeasureSettings(a).quantizedDataConsolidationFunction;i(e[a])},this.getMeasureData=function(a){return i[a]},this.getAllMeasureData=function(){return i},this.hasMeasureData=function(a){return i.hasOwnProperty(a)},s.call(this)},t.DataParser.QUANTIZE_YEAR=6,t.DataParser.QUANTIZE_MONTH=5,t.DataParser.QUANTIZE_DAY=4,t.DataParser.QUANTIZE_HOUR=3,t.DataParser.QUANTIZE_MINUTE=2,t.DataParser.QUANTIZE_SECOND=1,t.DataParser.QUANTIZE_MILLISECOND=0,t.DataParser.QUANTIZE_NONE=-1,t.DataParser.consolidators={},t.DataParser.consolidators.summation=function(a){a.sort(function(a,e){return a.x.getTime()-e.x.getTime()});for(var e=0;e<a.length;e++)for(;e+1<a.length&&a[e+1].x.getTime()===a[e].x.getTime();)a[e].y+=a[e+1].y,a[e].consolidatedData||(a[e].consolidatedData=[a[e].omhDatum]),a[e].consolidatedData.push(a[e+1].omhDatum),a[e].consolidationType="summation",a.splice(e+1,1)},t.DataParser.consolidators.average=function(a){t.DataParser.consolidators.summation(a);for(var e=0;e<a.length;e++){var i=a[e].consolidatedData?a[e].consolidatedData.length:0;i>0&&(a[e].y/=i,a[e].consolidationType="average")}},t});