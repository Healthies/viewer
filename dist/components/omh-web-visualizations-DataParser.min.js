!function(e,t){var a="OMHWebVisualizations";e[a]=t(e,a)}(this,function(e,t){var a,i=e.hasOwnProperty(t)?e[t]:{};return a=function(e,t,a){var i=null,n={},r={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},s=function(){var a=JSON.parse(JSON.stringify(e));return i=this.parseOmhData(a,t,moment),0===Object.keys(i).length?(console.log("Warning: no data of the specified type could be found."),!1):void 0};return this.resolveKeyPath=function(e,t){if(void 0===e)return e;var a;"string"==typeof t?(n[t]||(n[t]=t.split(".")),a=n[t].slice()):a=t;try{if(t&&a.length>0)return this.resolveKeyPath(e[a.shift()],a)}catch(i){console.info("Exception while resolving keypath",i)}return e},this.getIntervalDisplayDate=function(e,t,a){var i=e.body.effective_time_frame.time_interval,n=i.start_date_time?new Date(i.start_date_time).getTime():null,s=i.end_date_time?new Date(i.end_date_time).getTime():null,o=i.start_date_time?t(i.start_date_time):null,u=i.end_date_time?t(i.end_date_time):null,l=i.duration?i.duration.value:null;if(l){var c,d=i.duration.unit,f=r[d];"string"!=typeof f?(c=l*f,n||(n=s-c),s||(s=n+c)):(n||(n=u.subtract(l,r[d]).valueOf()),s||(s=o.add(l,r[d]).valueOf()))}return new Date(n)},this.quantizeDate=function(e,t){var a=t<=OMHWebVisualizations.DataParser.QUANTIZE_MONTH?e.getMonth():6,i=t<=OMHWebVisualizations.DataParser.QUANTIZE_DAY?e.getDate():t===OMHWebVisualizations.DataParser.QUANTIZE_MONTH?15:1,n=t<=OMHWebVisualizations.DataParser.QUANTIZE_HOUR?e.getHours():t===OMHWebVisualizations.DataParser.QUANTIZE_DAY?12:0,r=t<=OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?e.getMinutes():t===OMHWebVisualizations.DataParser.QUANTIZE_HOUR?30:0,s=t<=OMHWebVisualizations.DataParser.QUANTIZE_SECOND?e.getSeconds():t===OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?30:0,o=t<=OMHWebVisualizations.DataParser.QUANTIZE_MILLISECOND?e.getMilliseconds():t===OMHWebVisualizations.DataParser.QUANTIZE_SECOND?500:0;return new Date(e.getFullYear(),a,i,n,r,s,o)},this.parseOmhData=function(e,t,i){var n=this,r={},s={},o={};return e&&0!==e.length?(t.forEach(function(e,t){s[e]=a.getMeasureSettings(e).timeQuantizationLevel,o[e]=a.getMeasureSettings(e).valueKeyPath}),e.forEach(function(e){e.groupName="",t.forEach(function(t,a){var u=n.resolveKeyPath(e,o[t]);if(void 0!==u&&"object"!=typeof u){e.groupName+="_"+t,r.hasOwnProperty(t)||(r[t]=[]);var l;e.body.effective_time_frame.date_time&&(l=n.quantizeDate(new Date(e.body.effective_time_frame.date_time),s[t])),e.body.effective_time_frame.time_interval&&(l=n.quantizeDate(n.getIntervalDisplayDate(e,i),s[t])),r[t].push({y:u,x:l,provider:e.header.acquisition_provenance.source_name,omhDatum:e,primary:0===a,measure:t})}})}),t.forEach(function(e,t){s[e]!==OMHWebVisualizations.DataParser.QUANTIZE_NONE&&n.consolidateData(e,r)}),r):r},this.consolidateData=function(e,t){var i=a.getMeasureSettings(e).quantizedDataConsolidationFunction;i(t[e])},this.getMeasureData=function(e){return i[e]},this.getAllMeasureData=function(){return i},this.hasMeasureData=function(e){return i.hasOwnProperty(e)},s.call(this)},a.QUANTIZE_YEAR=6,a.QUANTIZE_MONTH=5,a.QUANTIZE_DAY=4,a.QUANTIZE_HOUR=3,a.QUANTIZE_MINUTE=2,a.QUANTIZE_SECOND=1,a.QUANTIZE_MILLISECOND=0,a.QUANTIZE_NONE=-1,a.consolidators={},a.consolidators.summation=function(e){e.sort(function(e,t){return e.x.getTime()-t.x.getTime()});for(var t=0;t<e.length;t++)for(;t+1<e.length&&e[t+1].x.getTime()===e[t].x.getTime();)e[t].y+=e[t+1].y,e[t].consolidatedData||(e[t].consolidatedData=[e[t].omhDatum]),e[t].consolidatedData.push(e[t+1].omhDatum),e[t].consolidationType="summation",e.splice(t+1,1)},a.consolidators.average=function(e){i.DataParser.consolidators.summation(e);for(var t=0;t<e.length;t++){var a=e[t].consolidatedData?e[t].consolidatedData.length:0;a>0&&(e[t].y/=a,e[t].consolidationType="average")}},i.DataParser=a,i});