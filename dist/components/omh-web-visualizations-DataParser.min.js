!function(e,a){var t="OMHWebVisualizations";e[t]=a(e,t)}(this,function(e,a){var t,i=e.hasOwnProperty(a)?e[a]:{};return t=function(e,a,t){var i=null,r={},n={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},s=function(){var t=JSON.parse(JSON.stringify(e));return i=this.parseOmhData(t,a,moment),0===Object.keys(i).length?(console.log("Warning: no data of the specified type could be found."),!1):void 0};return this.resolveKeyPath=function(e,a){if(void 0===e)return e;var t;"string"==typeof a?(r[a]||(r[a]=a.split(".")),t=r[a].slice()):t=a;try{if(a&&t.length>0)return this.resolveKeyPath(e[t.shift()],t)}catch(i){console.info("Exception while resolving keypath",i)}return e},this.getIntervalDisplayDate=function(e,a,t){var i=e.body.effective_time_frame.time_interval,r=i.start_date_time?new Date(i.start_date_time).getTime():null,s=i.end_date_time?new Date(i.end_date_time).getTime():null,o=i.start_date_time?a(i.start_date_time):null,u=i.end_date_time?a(i.end_date_time):null,g=i.duration?i.duration.value:null;if(g){var l,f=i.duration.unit,_=n[f];"string"!=typeof _?(l=g*_,r||(r=s-l),s||(s=r+l)):(r||(r=u.subtract(g,n[f]).valueOf()),s||(s=o.add(g,n[f]).valueOf()))}return new Date(r)},this.quantizeDate=function(e,a){var t=a<=OMHWebVisualizations.DataParser.QUANTIZE_MONTH?e.getMonth():6,i=a<=OMHWebVisualizations.DataParser.QUANTIZE_DAY?e.getDate():a===OMHWebVisualizations.DataParser.QUANTIZE_MONTH?15:1,r=a<=OMHWebVisualizations.DataParser.QUANTIZE_HOUR?e.getHours():a===OMHWebVisualizations.DataParser.QUANTIZE_DAY?12:0,n=a<=OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?e.getMinutes():a===OMHWebVisualizations.DataParser.QUANTIZE_HOUR?30:0,s=a<=OMHWebVisualizations.DataParser.QUANTIZE_SECOND?e.getSeconds():a===OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?30:0,o=a<=OMHWebVisualizations.DataParser.QUANTIZE_MILLISECOND?e.getMilliseconds():a===OMHWebVisualizations.DataParser.QUANTIZE_SECOND?500:0;return new Date(e.getFullYear(),t,i,r,n,s,o)},this.parseOmhData=function(e,a,i){var r=this,n={},s={},o={};return e&&0!==e.length?(a.forEach(function(e,a){s[e]=t.getMeasureSettings(e).data.xValueQuantization.period,o[e]=t.getMeasureSettings(e).data.yValuePath}),e.forEach(function(e){e.groupName="",a.forEach(function(a,t){var u=r.resolveKeyPath(e,o[a]);if(void 0!==u&&"object"!=typeof u){e.groupName+="_"+a,n.hasOwnProperty(a)||(n[a]=[]);var g;e.body.effective_time_frame.date_time&&(g=r.quantizeDate(new Date(e.body.effective_time_frame.date_time),s[a])),e.body.effective_time_frame.time_interval&&(g=r.quantizeDate(r.getIntervalDisplayDate(e,i),s[a])),n[a].push({y:u,x:g,provider:e.header.acquisition_provenance.source_name,omhDatum:e,primary:0===t,measure:a})}})}),a.forEach(function(e,a){s[e]!==OMHWebVisualizations.DataParser.QUANTIZE_NONE&&r.aggregateData(e,n)}),n):n},this.aggregateData=function(e,a){var i=t.getMeasureSettings(e).data.xValueQuantization.aggregator;i(a[e])},this.getMeasureData=function(e){return i[e]},this.getAllMeasureData=function(){return i},this.hasMeasureData=function(e){return i.hasOwnProperty(e)},s.call(this)},t.QUANTIZE_YEAR=6,t.QUANTIZE_MONTH=5,t.QUANTIZE_DAY=4,t.QUANTIZE_HOUR=3,t.QUANTIZE_MINUTE=2,t.QUANTIZE_SECOND=1,t.QUANTIZE_MILLISECOND=0,t.QUANTIZE_NONE=-1,t.aggregators={},t.aggregators.summation=function(e){e.sort(function(e,a){return e.x.getTime()-a.x.getTime()});for(var a=0;a<e.length;a++)for(;a+1<e.length&&e[a+1].x.getTime()===e[a].x.getTime();)e[a].y+=e[a+1].y,e[a].aggregatedData||(e[a].aggregatedData=[e[a].omhDatum]),e[a].aggregatedData.push(e[a+1].omhDatum),e[a].aggregationType="summation",e.splice(a+1,1)},t.aggregators.average=function(e){i.DataParser.aggregators.summation(e);for(var a=0;a<e.length;a++){var t=e[a].aggregatedData?e[a].aggregatedData.length:0;t>0&&(e[a].y/=t,e[a].aggregationType="average")}},i.DataParser=t,i});