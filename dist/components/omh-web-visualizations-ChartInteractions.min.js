!function(t,e){var n="OMHWebVisualizations";t[n]=e(t,n)}(this,function(t,e){var n,o=t.hasOwnProperty(e)?t[e]:{};return n=function(t,e,n,o,a){var i,c,l,r,s,u,d,m,f,p,h,v,g,x,b,y,D,P,T,w,S=864e5,C=n.getInterfaceSettings(),E={},k={},I=function(t){m&&(t=Math.max(t,m)),f&&(t=Math.min(t,f));var e=p.domain(),n=[e[0],new Date(e[0].getTime()+t*S)];p.domain(n)},M=function(t){return(t[1].getTime()-t[0].getTime())/S},B=function(t){var e=p.domain(),n=M(e);n*=(100-t)/100,m&&(n=Math.max(n,m)),f&&(n=Math.min(n,f));var o=[e[0],new Date(e[0].getTime()+n*S)];p.domain(o)},z=function(t){var e=p.domain(),n=M(e);n*=t/100;var o=[new Date(e[0].getTime()+n*S),new Date(e[1].getTime()+n*S)];p.domain(o)},F=function(){d3.selectAll(".time-button").classed("active",!1)},Z=function(t){g=new Plottable.Interactions.Pointer,g.onPointerExit(function(t){x.hide()}),g.onPointerEnter(y.bind(this)),D=function(e){var n;try{n=t.entityNearest(e),b(n),y()}catch(o){return}},g.onPointerMove(D),g.attachTo(t),P=t},A=function(t){u=new Plottable.Interactions.PanZoom,d=new Plottable.Interactions.PanZoom,u.addXScale(t.xScale),u.attachTo(t.plotGroup),d.addXScale(t.xScale),d.attachTo(t.xAxis),m&&(u.minDomainExtent(t.xScale,m*S),d.minDomainExtent(t.xScale,m*S)),f&&(u.maxDomainExtent(t.xScale,f*S),d.maxDomainExtent(t.xScale,f*S))},N=function(t){var e=[];d3.entries(o.getAllMeasureData()).forEach(function(t){var n=t.value;n.forEach(function(t){e.push(t.x)})});var n=t.extentOfValues(e),a=n[1].getTime()-n[0].getTime(),i=f*S;a>i&&(n[1]=new Date(n[0].getTime()+i)),t.domain(n)},R=function(){i=new Plottable.Interactions.Drag,c=function(){v&&v(),x&&y&&y()},i.onDrag(c)},O=function(){l=function(){y&&y(),F&&F(),v&&v()}},W=function(){s=new Plottable.Components.Label("( Drag chart to pan, pinch or scroll to zoom )",0).padding(10).yAlignment("bottom").xAlignment("right").addClass("zoom-hint-label"),v=function(){s.addClass("hidden")};var t=((new Plottable.Interactions.Click).attachTo(s).onClick(function(t){v()}),n.getMeasureSettings(e).chart.daysShownOnTimeline);m=t?t.min:!1,f=t?t.max:!1},H=function(){if(C.toolbar.enabled){if(h=t.append("div").classed("omh-chart-toolbar",!0).attr("unselectable","on"),C.timespanButtons.enabled){var e={"1wk":7,"1m":30,"3m":90,"6m":180};h.append("span").classed("time-buttons-label",!0).text("Show: "),d3.entries(e).forEach(function(t){var e=t.value,n=t.key;if((!f||f>=e)&&(!m||e>=m)){var o=h.append("span").classed("time-button",!0).text(n);o.on("click",function(){F(),I(e),d3.select(this).classed("active",!0)})}})}if(C.zoomButtons.enabled){var n={"&#8722;":-20,"&#43;":20};h.append("span").classed("zoom-buttons-label",!0).text(" Zoom: "),d3.entries(n).forEach(function(t){var e=t.value,n=t.key,o=h.append("span").classed("zoom-button",!0).html(n);o.on("click",function(){F(),B(e)})})}if(C.navigation.enabled){var o=h.append("span",":first-child").classed("previous-time-period-button",!0).text("< prev");o.on("click",function(){z(-100)});var a=h.append("span").classed("next-time-period-button",!0).text("next >");a.on("click",function(){z(100)})}}},X=function(){if(C.tooltips.enabled){var t=null,e=null,n=function(t){e=t.selection.style("opacity"),t.selection.style("opacity","1")},o=function(t){t.selection.style("opacity",e)},i=function(t,e){k[t][e].forEach(function(t){n(t)})},c=function(t,e){k[t][e].forEach(function(t){o(t)})},l=function(t){x.show(t.datum,t.selection[0][0])},r=function(t){t&&w&&(t.selection[0][0].getBoundingClientRect().left>w[0][0].getBoundingClientRect().left&&t.selection[0][0].getBoundingClientRect().right<w[0][0].getBoundingClientRect().right?l(t):x.hide())};y=function(){if(t&&w)if(t.datum.primary||!C.tooltips.grouped)r(t);else{var e=E[t.datum.omhDatum.groupName][t.index],n=d3.select(".d3-tip").node().clientHeight;r(e.selection[0][0].getBoundingClientRect().top>w[0][0].getBoundingClientRect().top+n?e:t)}},b=function(e){if(null!==t){var n=C.tooltips.grouped,o=e.datum.omhDatum.body!==t.datum.omhDatum.body,a=e.datum.measure!==t.datum.measure,l=n?o:o||a;l&&(c(t.datum.omhDatum.groupName,t.index),t=e,i(t.datum.omhDatum.groupName,e.index))}else t=e;null===e.datum};var s=function(t){var e;if(C.tooltips&&"undefined"!=typeof C.tooltips.contentFormatter)e=C.tooltips.contentFormatter(t);else{var n="undefined"!=typeof C.decimalPlaces?C.decimalPlaces:1;e=t.y.toFixed(n)}var o='<div class="value">'+e+"</div>",a=C.tooltips.timeFormat;return o+='<div class="time">'+moment(t.x).format(a)+"</div>",o+='<div class="provider">'+t.provider+"</div>"};x=d3.tip().attr("class","d3-tip").html(function(e){var n=t.component,o=a.resolveStyleNameForDatumInPlot(e,n);o=o.toLowerCase().replace(/[^a-z0-9]+/g,"_");var i=e.measure+" "+o;return'<div class="omh-tooltip '+i+'">'+s(e)+"</div>"})}},L=function(){R(),O(),W(),H(),X()};this.getTooltip=function(){return x},this.getToolbar=function(){return h},this.getPanZoomInteraction=function(){return u},this.getpanZoomInteractionXAxis=function(){return d},this.addToComponents=function(t){if(C.tooltips.enabled)for(var e in t.plots){var n=t.plots[e];if(n instanceof Plottable.Plots.Scatter&&n.datasets()&&n.datasets().length>0){Z(n);break}}f&&N(t.xScale),C.panZoom.enabled&&(A(t),C.panZoom.showHint&&t.plots.push(s),i.attachTo(t.table)),T=t.table,p=t.xScale},this.addToSelection=function(t){w=t,r&&r.offWheel(l),r=new Plottable.Dispatchers.Mouse.getDispatcher(w[0][0]).onWheel(l),x&&w.call(x)},this.addTooltipsToEntities=function(t){E={},k={},t.forEach(function(t){var e=t.datum.omhDatum.groupName;E[e]||(E[e]=[]),t.datum.primary&&(E[e][t.index]=t),k[e]||(k[e]=[]),k[e][t.index]||(k[e][t.index]=[]),k[e][t.index].push(t)})},this.destroy=function(){g&&g.offPointerMove(D),g&&g.detachFrom(P),i&&i.detachFrom(T),x&&x.destroy(),r&&r.offWheel(l),y&&i.offDrag(y),h&&h.remove()},L.call(this)},o.ChartInteractions=n,o});