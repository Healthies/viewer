!function(t,e){var n="OMHWebVisualizations";t[n]=e(t,n)}(this,function(t,e){var n=t.hasOwnProperty(e)?t[e]:{};return n.ChartInteractions=function(t,e,n,o){var a,i,c,l,r,s,u,d,m,f,p,h,v,g,x,b,y,D,P,T,w=864e5,S=e.getInterfaceSettings(),C={},E={},k=function(t){d&&(t=Math.max(t,d)),m&&(t=Math.min(t,m));var e=f.domain(),n=[e[0],new Date(e[0].getTime()+t*w)];f.domain(n)},I=function(t){return(t[1].getTime()-t[0].getTime())/w},M=function(t){var e=f.domain(),n=I(e);n*=(100-t)/100,d&&(n=Math.max(n,d)),m&&(n=Math.min(n,m));var o=[e[0],new Date(e[0].getTime()+n*w)];f.domain(o)},B=function(t){var e=f.domain(),n=I(e);n*=t/100;var o=[new Date(e[0].getTime()+n*w),new Date(e[1].getTime()+n*w)];f.domain(o)},z=function(){d3.selectAll(".time-button").classed("active",!1)},F=function(t){v=new Plottable.Interactions.Pointer,v.onPointerExit(function(t){g.hide()}),v.onPointerEnter(b.bind(this)),y=function(e){var n;try{n=t.entityNearest(e),x(n),b()}catch(o){return}},v.onPointerMove(y),v.attachTo(t),D=t},A=function(t){S.panZoom.enabled&&(s=new Plottable.Interactions.PanZoom,u=new Plottable.Interactions.PanZoom,s.addXScale(t.xScale),s.attachTo(t.plotGroup),u.addXScale(t.xScale),u.attachTo(t.xAxis),d&&(s.minDomainExtent(t.xScale,d*w),u.minDomainExtent(t.xScale,d*w)),m&&(s.maxDomainExtent(t.xScale,m*w),u.maxDomainExtent(t.xScale,m*w)))},N=function(t){var e=[];d3.entries(n.getAllMeasureData()).forEach(function(t){var n=t.value;n.forEach(function(t){e.push(t.x)})});var o=t.extentOfValues(e),a=o[1].getTime()-o[0].getTime(),i=m*w;a>i&&(o[1]=new Date(o[0].getTime()+i)),t.domain(o)},R=function(){a=new Plottable.Interactions.Drag,i=function(){h&&h(),g&&b&&b()},a.onDrag(i)},Z=function(){c=function(){b&&b(),z&&z(),h&&h()}},O=function(){r=new Plottable.Components.Label("( Drag chart to pan, pinch or scroll to zoom )",0).padding(10).yAlignment("bottom").xAlignment("right").addClass("zoom-hint-label"),h=function(){r.addClass("hidden")};var t=((new Plottable.Interactions.Click).attachTo(r).onClick(function(t){h()}),e.getPrimaryMeasureSettings().chart.daysShownOnTimeline);d=t?t.min:!1,m=t?t.max:!1},W=function(){if(S.toolbar.enabled){if(p=t.append("div").classed("omh-chart-toolbar",!0).attr("unselectable","on"),S.timespanButtons.enabled){var e={"1wk":7,"1m":30,"3m":90,"6m":180};p.append("span").classed("time-buttons-label",!0).text("Show: "),d3.entries(e).forEach(function(t){var e=t.value,n=t.key;if((!m||m>=e)&&(!d||e>=d)){var o=p.append("span").classed("time-button",!0).text(n);o.on("click",function(){z(),k(e),d3.select(this).classed("active",!0)})}})}if(S.zoomButtons.enabled){var n={"&#8722;":-20,"&#43;":20};p.append("span").classed("zoom-buttons-label",!0).text(" Zoom: "),d3.entries(n).forEach(function(t){var e=t.value,n=t.key,o=p.append("span").classed("zoom-button",!0).html(n);o.on("click",function(){z(),M(e)})})}if(S.navigation.enabled){var o=p.append("span",":first-child").classed("previous-time-period-button",!0).text("< prev");o.on("click",function(){B(-100)});var a=p.append("span").classed("next-time-period-button",!0).text("next >");a.on("click",function(){B(100)})}}},H=function(){if(S.tooltips.enabled){var t=null,e=null,n=function(t){e=t.selection.style("opacity"),t.selection.style("opacity","1")},a=function(t){t.selection.style("opacity",e)},i=function(t,e){E[t][e].forEach(function(t){n(t)})},c=function(t,e){E[t][e].forEach(function(t){a(t)})},l=function(t){g.show(t.datum,t.selection[0][0])},r=function(t){t&&T&&(t.selection[0][0].getBoundingClientRect().left>T[0][0].getBoundingClientRect().left&&t.selection[0][0].getBoundingClientRect().right<T[0][0].getBoundingClientRect().right?l(t):g.hide())};b=function(){if(t&&T)if(t.datum.primary||!S.tooltips.grouped)r(t);else{var e=C[t.datum.omhDatum.groupName][t.index],n=d3.select(".d3-tip").node().clientHeight;r(e.selection[0][0].getBoundingClientRect().top>T[0][0].getBoundingClientRect().top+n?e:t)}},x=function(e){if(null!==t){var n=S.tooltips.grouped,o=e.datum.omhDatum.body!==t.datum.omhDatum.body,a=e.datum.measure!==t.datum.measure,l=n?o:o||a;l&&(c(t.datum.omhDatum.groupName,t.index),t=e,i(t.datum.omhDatum.groupName,e.index))}else t=e;null===e.datum};var s=function(t){var e;if(S.tooltips&&"undefined"!=typeof S.tooltips.contentFormatter)e=S.tooltips.contentFormatter(t);else{var n="undefined"!=typeof S.decimalPlaces?S.decimalPlaces:1;e=t.y.toFixed(n)}var o='<div class="value">'+e+"</div>",a=S.tooltips.timeFormat;return o+='<div class="time">'+moment(t.x).format(a)+"</div>",o+='<div class="provider">'+t.provider+"</div>"};g=d3.tip().attr("class","d3-tip").html(function(e){var n=t.component,a=o.resolveStyleNameForDatumInPlot(e,n);a=a.toLowerCase().replace(/[^a-z0-9]+/g,"_");var i=e.measure+" "+a;return'<div class="omh-tooltip '+i+'">'+s(e)+"</div>"})}},X=function(){R(),Z(),O(),W(),H()};this.getTooltip=function(){return g},this.getToolbar=function(){return p},this.getPanZoomInteraction=function(){return s},this.getpanZoomInteractionXAxis=function(){return u},this.addToComponents=function(t){for(var e in t.plots){var n=t.plots[e];if(n instanceof Plottable.Plots.Scatter&&n.datasets()&&n.datasets().length>0){F(n);break}}A(t),m&&N(t.xScale),S.enabled&&S.showHint&&t.plots.push(r),a.attachTo(t.table),P=t.table,f=t.xScale},this.addToSelection=function(t){T=t,l&&l.offWheel(c),l=new Plottable.Dispatchers.Mouse.getDispatcher(T[0][0]).onWheel(c),g&&T.call(g)},this.addTooltipsToEntities=function(t){C={},E={},t.forEach(function(t){var e=t.datum.omhDatum.groupName;C[e]||(C[e]=[]),t.datum.primary&&(C[e][t.index]=t),E[e]||(E[e]=[]),E[e][t.index]||(E[e][t.index]=[]),E[e][t.index].push(t)})},this.destroy=function(){v&&v.offPointerMove(y),v&&v.detachFrom(D),a&&a.detachFrom(P),g&&g.destroy(),l&&l.offWheel(c),b&&a.offDrag(b),p&&p.remove()},X.call(this)},n});