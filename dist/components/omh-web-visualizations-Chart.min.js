!function(e,t){var n="OMHWebVisualizations";e[n]=t(e,n)}(this,function(e,t){var n,a=e.hasOwnProperty(t)?e[t]:{};return n=function(e,t,n,a){var i,o=n.split(/\s*,\s*/),r=null,s=new OMHWebVisualizations.ChartConfiguration(a),l=new OMHWebVisualizations.DataParser(e,o,s),u=new OMHWebVisualizations.ChartStyles(s),c=new OMHWebVisualizations.ChartInteractions(t,o[0],s,l,u);this.initialized=!1,"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]),t.node||(t=d3.select(t)),a||(a={}),t.classed("omh-chart-container",!0);var d=new Plottable.Scales.Time,g=new Plottable.Scales.Linear,f=null,h=s.getMeasureSettings(o[0]).range;h&&g.domainMin(h.min).domainMax(h.max);var p=new Plottable.Axes.Time(d,"bottom").margin(15).addClass("x-axis"),b=new Plottable.Axes.Numeric(g,"left"),m=new Plottable.Components.AxisLabel(s.getMeasureSettings(o[0]).units,"0").padding(5).xAlignment("right").yAlignment("top"),x=[],y=(new Plottable.Plots.Scatter).x(function(e){return e.x},d).y(function(e){return e.y},g);u.setStylesForPlot(u.getConfiguredDefaultStylesForPlot(y),y);var P=[],v=0,w=[];d3.entries(l.getAllMeasureData()).forEach(function(e){var t=e.key;"clustered_bar"===s.getMeasureSettings(t).chart.type&&v++});var S,C,A=[],M=function(e){e.max&&A.push(e.max),e.min&&A.push(e.min)};if(s.getInterfaceSettings().thresholds.show!==!1&&(o.forEach(function(e){var t=s.getMeasureSettings(e).thresholds;t&&M(t)}),A.length>0)){A.sort(function(e,t){return e-t});var D=new Plottable.Scales.Linear;D.domain(g.domain()),D.range(g.range()),f=function(e){D.domain(e.domain()),D.range(e.range())},g.onUpdate(f);var T=function(e){var t=A;return t};D.tickGenerator(T),C=new Plottable.Axes.Numeric(D,"right").tickLabelPosition("top").tickLabelPadding(1).showEndTickLabels(!0).addClass("gridlines-axis"),S=new Plottable.Components.Gridlines(null,D),x.push(S),x.push(C)}o.forEach(function(e){if(l.hasMeasureData(e)){var t=l.getMeasureData(e),n=new Plottable.Dataset(t),a=s.getMeasureSettings(e);if(n.measure=e,"clustered_bar"===a.chart.type){var i=g;if(P.length>0){var o=a.range,r=a.units;i=(new Plottable.Scales.Linear).domainMin(o.min).domainMax(o.max);var c=new Plottable.Axes.Numeric(i,"right"),f=new Plottable.Components.AxisLabel(r,"0").padding(5).xAlignment("left").yAlignment("top");w.push({measure:e,axis:c,label:f,scale:i})}var h=(new Plottable.Plots.ClusteredBar).x(function(e){return e.x},d).y(function(e){return e.y},i);u.setStylesForPlot(u.getConfiguredDefaultStylesForPlot(h),h),P.push(h);for(var b=0;v>b;b++)h.addDataset(b===P.length-1?n:new Plottable.Dataset([]));var m=p.axisConfigurations(),S=[];m.forEach(function(e){("day"===e[0].interval||"month"===e[0].interval||"year"===e[0].interval)&&S.push(e)}),p.axisConfigurations(S),h.addClass("clustered-bar-plot-"+e),x.push(h)}else{var C=(new Plottable.Plots.Line).x(function(e){return e.x},d).y(function(e){return e.y},g);u.setStylesForPlot(u.getConfiguredDefaultStylesForPlot(C),C),C.addDataset(n),y.addDataset(n),C.addClass("line-plot-"+e),x.push(C)}}}),y.addClass("point-plot"),x.push(y);var L=null,z=null;if(s.getInterfaceSettings().legend){L=new Plottable.Scales.Color,z=new Plottable.Components.Legend(L);var E=[],I=[];d3.entries(l.getAllMeasureData()).forEach(function(e){var t,n=e.key,a=s.getMeasureSettings(n),i=a.seriesName,o=a.chart.type;switch(o){case"clustered_bar":t=a.chart.barColor;break;default:t=a.chart.pointFillColor}i&&t&&(E.push(i),I.push(t))}),L.domain(E),L.range(I),z.maxEntriesPerRow(2),z.symbol(Plottable.SymbolFactories.square),z.xAlignment("right"),z.yAlignment("top"),x.push(z)}var F=s.getInterfaceSettings().axes.xAxis.visible,G=s.getInterfaceSettings().axes.yAxis.visible,k=new Plottable.Components.Group(x),O=G?new Plottable.Components.Group([b,m]):null,W=[O,k],H=[null,F?p:null];G&&w.forEach(function(e){W.push(new Plottable.Components.Group([e.axis,e.label])),H.push(null)}),r=new Plottable.Components.Table([W,H]),r.yAlignment("bottom"),c.addToComponents({plots:x,plotGroup:k,table:r,xScale:d,xAxis:p}),this.destroy=function(){c.destroy(),r&&r.destroy(),f&&g.offUpdate(f)},this.getComponents=function(){if(!this.initialized)return{};var e={};e[o[0]]=g;var t={};t[o[0]]=b;var n={};n[o[0]]=m;var a={};a[o[0]]=d;var i={};i[o[0]]=p;var s={};return s[o[0]]=L,w.forEach(function(a){e[a.measure]=a.scale,t[a.measure]=a.axis,n[a.measure]=a.label}),{xScales:a,yScales:e,colorScales:s,gridlines:{gridlines:S,yAxis:C,values:A},legends:[z],xAxes:i,yAxes:t,plots:x,yLabels:n,table:r,tooltip:c.getTooltip(),toolbar:c.getToolbar(),panZoomInteractions:{plotGroup:c.getPanZoomInteraction(),xAxis:c.getpanZoomInteractionXAxis()}}},this.getPlots=function(e){return e?x.filter(function(t){return t instanceof e}):x},this.addGridline=function(e){A.push(e)},this.getMeasures=function(){return o},this.getStyles=function(){return u},this.getInteractions=function(){return c},this.getConfiguration=function(){return s},this.getParser=function(){return l},this.getD3Selection=function(){return i},this.renderTo=function(e){return this.initialized?(i=d3.select(e),c.addToSelection(i),r.renderTo(i),u.addToSelection(i),void c.addTooltipsToEntities(y.entities())):void console.log("Warning: chart could not be rendered because it was not successfully initialized.")},this.initialized=!0},a.Chart=n,a});